################# SETUP ####################
## I have the following in my zshrc file:
#
# eval "$(/Users/palas/.local/bin/mise activate zsh)"
# export MISE_EXPERIMENTAL=1
# alias m="mise"
# alias ml="mise task ls"
# alias mla="mise run //:mise-list-all --search-string"
# 
## the mta alias allows me to list all available tasks and filter using a string
## $ mta foo # returns all tasks containing foo
#############################################

# https://mise.jdx.dev/tasks/monorepo.html
# MISE_EXPERIMENTAL=1 set in zshrc
experimental_monorepo_root = true

[tools]
yq = "4"
jq = "1"

[tasks.mise-list-all]
description = "[Mise Task All] Filter mise tasks with grep; empty string shows all"
usage = '''
flag "--search-string <string>" help="String to filter tasks by (can be empty)"
'''
run = '''
#!/usr/bin/env bash
set -euo pipefail

SEARCH_STRING="${usage_search_string-}"  # allow empty

# Default to literal match; override with GREP_FLAGS='-E', '-Fi', etc.
GREP_FLAGS="${GREP_FLAGS:--F}"

if [ -z "$SEARCH_STRING" ]; then
  mise task --all
else
  # Don't fail the task on no matches
  mise task ls --all | grep ${GREP_FLAGS} -- "$SEARCH_STRING" || true
fi
'''
