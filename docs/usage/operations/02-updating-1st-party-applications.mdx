---
title: 'Updating 1st Party Applications'
description: 'Deploy changes to your applications'
icon: 'person-shelter'
---

## Overview

First-party applications are services you build and deploy—like the `go-backend` example in the kit. This page covers how to make changes and deploy them through the GitOps pipeline.

## Deployment Flow

```
Code Change → Push to main → CI builds image → GitOps updates manifests → ArgoCD syncs
```

1. **Push code changes** to `main` branch (in `services/` directory)
2. **CI workflow** detects changes, builds Docker image, pushes to ECR
3. **GitOps workflow** updates image tags in Kubernetes manifests
4. **ArgoCD** detects manifest changes and syncs to the cluster

## Make Code Changes

<Steps>
  <Step title="Edit your service code">
    Make changes to your application in `services/`:

    ```bash
    # Example: modify the go-backend service
    vim services/go-backend/cmd/main.go
    ```
  </Step>

  <Step title="Test locally">
    Use the local development environment to test:

    ```bash
    cd local
    mise run tilt-up
    ```

    Tilt automatically rebuilds and redeploys when you save changes.
  </Step>

  <Step title="Commit and push">
    ```bash
    git add services/go-backend/
    git commit -m "feat: add new endpoint for health checks"
    git push origin main
    ```
  </Step>
</Steps>

## What Happens After Push

### 1. CI Build Workflow

The `ci-build-push.yml` workflow:

1. Detects which services changed using path filters
2. Generates a version tag (e.g., `0.2.2-rc0029-g1234567`)
3. Builds the Docker image
4. Pushes to ECR
5. Triggers the GitOps workflow

### 2. GitOps Update Workflow

The `gitops-update-manifests.yml` workflow:

1. Updates the image tag in values files (e.g., `kubernetes/src/services/go-backend-helm/values.yaml`)
2. Renders the Kubernetes manifests
3. Commits and pushes to `main`

The image tag is identified by a comment marker:

```yaml
image:
  version: 0.2.2-rc0029-g1234567 # staging_services/go-backend
```

### 3. ArgoCD Sync

ArgoCD watches the repository and automatically syncs when manifests change. You can monitor the sync in the ArgoCD UI or CLI:

```bash
argocd app get go-backend-helm
argocd app sync go-backend-helm
```

## Version Tagging Strategy

| Trigger | Tag Format | Example | Environment |
|---------|------------|---------|-------------|
| Push to `main` | `X.Y.Z-rcNNNN-gSHA` | `0.2.2-rc0029-g1234567` | Staging |
| Release tag | `X.Y.Z` | `0.2.3` | Production |
| Manual workflow | User-specified | `hotfix-123` | User-specified |

### Pre-release Versions (Staging)

When you push to `main`, the version is generated as:
- Base: last release tag + 1 patch (e.g., `0.2.2` → `0.2.3`)
- Suffix: `-rcNNNN-gSHA` where NNNN is commits since last tag

This ensures every commit has a unique, sortable version.

### Release Versions (Production)

To deploy to production, create a release tag:

```bash
git tag "services/go-backend@0.2.3"
git push origin "services/go-backend@0.2.3"
```

This triggers the same build workflow but:
- Uses the exact version from the tag (`0.2.3`)
- Sets environment to `production`

## Deploy to Production

<Steps>
  <Step title="Verify staging deployment">
    Ensure the change works correctly in staging before promoting to production.
  </Step>

  <Step title="Create a release">
    Use Release Please (automated) or create a tag manually:

    ```bash
    # Manual tag
    git tag "services/go-backend@0.2.3"
    git push origin "services/go-backend@0.2.3"
    ```

    Or merge a Release Please PR to trigger the release automatically.
  </Step>

  <Step title="Monitor the deployment">
    Watch the CI workflow and ArgoCD sync:

    ```bash
    # Check workflow status
    gh run list --workflow=ci-build-push.yml

    # Check ArgoCD
    argocd app get go-backend-helm --grpc-web
    ```
  </Step>
</Steps>

## Manual Deployment

For debugging or hotfixes, you can trigger deployments manually:

<Tabs>
  <Tab title="Build only">
    Build and push an image without deploying:

    ```bash
    gh workflow run ci-build-push.yml \
      -f service=services/go-backend \
      -f version=hotfix-123
    ```
  </Tab>

  <Tab title="Deploy existing image">
    Deploy an already-built image to an environment:

    ```bash
    gh workflow run gitops-update-manifests.yml \
      -f service=services/go-backend \
      -f version=0.2.2-rc0029-g1234567 \
      -f environment=staging
    ```
  </Tab>
</Tabs>

## Update Kubernetes Configuration

To change Kubernetes configuration (replicas, resources, etc.) without changing application code:

<Steps>
  <Step title="Edit the values file">
    ```bash
    vim kubernetes/src/services/go-backend-helm/values.yaml
    ```

    Example changes:
    ```yaml
    replicas: 3  # Increase replicas
    resources:
      requests:
        memory: "256Mi"
        cpu: "250m"
    ```
  </Step>

  <Step title="Render manifests">
    ```bash
    cd kubernetes
    mise run render
    ```
  </Step>

  <Step title="Commit and push">
    ```bash
    git add kubernetes/
    git commit -m "chore: increase go-backend replicas to 3"
    git push origin main
    ```
  </Step>
</Steps>

ArgoCD syncs the new configuration without rebuilding the image.

## Rollback

To rollback to a previous version:

<Tabs>
  <Tab title="Via ArgoCD">
    ```bash
    # View history
    argocd app history go-backend-helm

    # Rollback to previous revision
    argocd app rollback go-backend-helm <revision>
    ```
  </Tab>

  <Tab title="Via GitOps">
    Update the image tag to a previous version:

    ```bash
    # Edit values.yaml
    vim kubernetes/src/services/go-backend-helm/values.yaml

    # Change image version to previous tag
    # image:
    #   version: 0.2.2-rc0028-g98b8c55

    # Render and push
    cd kubernetes && mise run render
    git add . && git commit -m "fix: rollback go-backend to 0.2.2-rc0028"
    git push origin main
    ```
  </Tab>
</Tabs>

## Troubleshooting

### Build fails

1. Check the workflow logs:
   ```bash
   gh run view --log
   ```

2. Common issues:
   - Dockerfile syntax errors
   - Missing dependencies
   - Test failures

### Image not updating in cluster

1. Verify the image tag was updated:
   ```bash
   git log --oneline -5
   # Look for "chore: update staging, services/go-backend, ..."
   ```

2. Check ArgoCD sync status:
   ```bash
   argocd app get go-backend-helm
   ```

3. Force a sync:
   ```bash
   argocd app sync go-backend-helm --force
   ```

### Pods crashing after deployment

1. Check pod logs:
   ```bash
   kubectl logs -f deployment/go-backend -n go-backend
   ```

2. Check events:
   ```bash
   kubectl describe pod -l app=go-backend -n go-backend
   ```

3. Rollback if needed (see Rollback section above)

## Next Steps

- [Updating 3rd Party Applications](/usage/operations/03-updating-3rd-party-applications) - Update infrastructure components
- [Bootstrapping a New Service](/usage/operations/04-bootstrapping-new-service) - Add a new application
