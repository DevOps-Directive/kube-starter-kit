# Source: groundcover-wrapper/charts/groundcover/charts/backend/charts/keep/templates/delete-secret-job.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: delete-keep-secrets
  annotations:
    helm.sh/hook: pre-delete
    helm.sh/hook-delete-policy: hook-succeeded,hook-failed
  labels:
    helm.sh/chart: keep-0.1.67
    app.kubernetes.io/name: keep
    app.kubernetes.io/instance: groundcover
    app.kubernetes.io/version: 0.37.20
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/part-of: keep
    app.kubernetes.io/component: secrets
spec:
  template:
    spec:
      serviceAccountName: groundcover-keep
      containers:
        - name: delete-secrets-container
          image: public.ecr.aws/groundcovercom/bitnami/kubectl:latest
          pullPolicy: Always
          command:
            - /bin/sh
            - -c
            - |
              secrets=$(kubectl get secrets -n groundcover -o name | grep '^secret/keep-'); if [ -n "$secrets" ]; then
                echo "$secrets" | xargs kubectl delete -n groundcover;
              else
                echo "No matching secrets found to delete.";
              fi
      restartPolicy: Never
