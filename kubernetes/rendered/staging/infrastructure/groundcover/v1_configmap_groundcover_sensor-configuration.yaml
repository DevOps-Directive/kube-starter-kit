# Source: groundcover-wrapper/charts/groundcover/templates/agent/config/sensor/config.yaml
apiVersion: v1
data:
  config.yaml: "# Include the deprecated configuration to make sensor log and metricate when deprecated config is used\n\n\nserviceName: sensor\nalligatorConfigurationExists: false \nhealthProbe:\n  enabled: true\n  port: 2021\nreceivers:\n  \n  remotewrite:\n    enabled: true\n    port: 8428\n  \n  \n  metricsscraper:\n    enabled: false\n    maxScrapeSize: 6.7108864e+07\n  \nexporters:\n  remotewrite:\n    url: http://groundcover-metrics-ingester:8429/api/v1/write\n    usePrometheusCompatibleNaming: true\n    tlsSkipVerify: true\n    maxDiskUsagePerURL: \n    tmpDataPath: \npipelines:\n  metrics:\n    enricherEnabled: true\nstartuptimeout: 120s\n\nproductchansize: 512\npushsummaries: true\nproductmetricsflushmintotalcounter:\n  http: 1\n  redis: 1\n  amqp: 1\n  sql: 1\n  kafka: 1\n  dns: 1\n  grpc: 1\n  mongodb: 1\n  node_info: 1\n  container_crash: 1\n  container_info: 1\n  container_state: 1\n  container_oomkill: 1\n  pvc_info: 1\n\nhttphandler:\n  samplesthreshold: 10\n  issuesthreshold: 10\n  sampling:\n    samplingmode: 1 # DefaultSample\n    samplingLimitMaxQueue: 0\n    samplingLimitAgeOut: 0s\n  \n  truncationConfig:\n    enabled: true\n    payloadSizeLimit: 10240\n  \n  \n  interval: 30s\n  summarizerActiveTtl: 45s\n  aggregationCacheSize: 4096\n\ngrpchandler:\n  samplesthreshold: 10\n  issuesthreshold: 10\n  sampling:\n    samplingmode: 1 # DefaultSample\n    samplingLimitMaxQueue: 0\n    samplingLimitAgeOut: 0s\n  \n  truncationConfig:\n    enabled: true\n    payloadSizeLimit: 10240\n  \n  \n  interval: 30s\n  summarizerActiveTtl: 45s\n  aggregationCacheSize: 4096\n\nredishandler:\n  samplesthreshold: 10\n  issuesthreshold: 10\n  sampling:\n    samplingmode: 1 # DefaultSample\n    samplingLimitMaxQueue: 0\n    samplingLimitAgeOut: 0s\n  \n  truncationConfig:\n    enabled: true\n    payloadSizeLimit: 10240\n  \n  \n  interval: 30s\n  summarizerActiveTtl: 45s\n  aggregationCacheSize: 4096\n  obfuscateSensitiveValues: true\n\namqphandler:\n  samplesthreshold: 10\n  issuesthreshold: 10\n  sampling:\n    samplingmode: 1 # DefaultSample\n    samplingLimitMaxQueue: 0\n    samplingLimitAgeOut: 0s\n  \n  \n  interval: 30s\n  summarizerActiveTtl: 45s\n  aggregationCacheSize: 4096\n\nsqlhandler:\n  samplesthreshold: 10\n  issuesthreshold: 10\n  sampling:\n    samplingmode: 1 # DefaultSample\n    samplingLimitMaxQueue: 0\n    samplingLimitAgeOut: 0s\n  \n  truncationConfig:\n    enabled: true\n    payloadSizeLimit: 10240\n  \n  \n  interval: 30s\n  summarizerActiveTtl: 45s\n  aggregationCacheSize: 4096\n\nkafkahandler:\n  samplesthreshold: 10\n  issuesthreshold: 10\n  sampling:\n    samplingmode: 1 # DefaultSample\n    samplingLimitMaxQueue: 10\n    samplingLimitAgeOut: 1s\n  \n  truncationConfig:\n    enabled: true\n    payloadSizeLimit: 10240\n  \n  \n  interval: 30s\n  summarizerActiveTtl: 45s\n  aggregationCacheSize: 4096\n\ndnshandler:\n  samplesthreshold: 10\n  issuesthreshold: 10\n  sampling:\n    samplingmode: 1 # DefaultSample\n    samplingLimitMaxQueue: 10\n    samplingLimitAgeOut: 1s\n  \n  truncationConfig:\n    enabled: \n    payloadSizeLimit: \n  \n  \n  interval: 30s\n  summarizerActiveTtl: 45s\n  aggregationCacheSize: 300\n\nmongodbhandler:\n  samplesthreshold: 10\n  issuesthreshold: 10\n  sampling:\n    samplingmode: 1 # DefaultSample\n    samplingLimitMaxQueue: 0\n    samplingLimitAgeOut: 0s\n  \n  truncationConfig:\n    enabled: true\n    payloadSizeLimit: 10240\n  \n  \n  interval: 30s\n  summarizerActiveTtl: 45s\n  aggregationCacheSize: 4096\n\ncontainerInfoHandler:\n  samplesthreshold: 10\n  issuesthreshold: 10\n  sampling:\n    samplingmode: 0 # DontSample\n    samplingLimitMaxQueue: 0\n    samplingLimitAgeOut: 0s\n  interval: 30s\n  summarizerActiveTtl: 45s\n  aggregationCacheSize: 4096\n\npvcIoHandler:\n  sampling:\n    samplingmode: 0 # DontSample\n  interval: 10s\n  summarizerActiveTtl: 90s\n  aggregationCacheSize: 4096\n\nl4MetricsHandler:\n  sampling:\n    samplingmode: 0 # DontSample\n  interval: 10s\n  summarizerActiveTtl: 90s\n  aggregationCacheSize: 10240\n\ncontainerStateHandler:\n  samplesthreshold: 10\n  issuesthreshold: 10\n  sampling:\n    samplingmode: 0 # DontSample\n    samplingLimitMaxQueue: 0\n    samplingLimitAgeOut: 0s\n  interval: 30s\n  summarizerActiveTtl: 45s\n  aggregationCacheSize: 4096\n\ncontainercrashhandler:\n  sampling:\n    samplingmode: 0 # DontSample\n  interval: 30s\n  summarizerActiveTtl: 0\n  aggregationCacheSize: 1024\n\npvcinfohandler:\n  samplesthreshold: 20\n  issuesthreshold: 20\n  sampling:\n    samplingmode: 0 # DontSample\n    samplingLimitMaxQueue: 0\n    samplingLimitAgeOut: 0s\n  interval: 1m0s\n  summarizerActiveTtl: 45s\n  aggregationCacheSize: 1024\n\npidcache:\n  expiration: 5m\n  purge: 20s\n\n\ncluster:\n  maxhosts: 10000\n  maxchildrens: 40\n  childcountruleoverrides: [{\"depth\":0,\"maxChildren\":100}]\n\nloglevel: 4 # INFO\n\n\nisk8s: true\n\n\nallowedportspercontainer: 20\n\nk8smetricsfetcher:\n  fetchinterval: 15s\n  requesttimeout: 10s\n  fetchKubeletInfraMetrics: false\n\n\n\npiiDetector:\n  enabled: true\n  sizeLimit: 1024\n\n\ngloballimiter:\n  maxqueue: 20\n  ageout: 100ms\n  sampleeverything: false\n\nwatchOnlyLocalNode: false\n\nfloraEnabled: true\n\ncollectionEnabled: true\ningestionEnabled: true\nrunningNamespace: \"\"\n\nshouldDropRunningNamespaces: true\ntracesNamespaceFilters: \n  []\ntracesWorkloadFilters: \n  []\nnodelabels: \n  []\ncontentTypesToDrop: \n  []\ncontentTypesWithoutClustering: \n  []\nhostHeadersToDrop: \n  []\nheadersForceSampling: \n  b3ForceSample: true\n  datadogForceSample: true\n  gcForceSample: true\n  w3cForceSample: true\ncustomEntityTags: \n  annotations:\n    collectAll: false\n    keys: []\n  labels:\n    collectAll: false\n    keys: []\nsendKubeletInfraMetrics: true\n\n\n\napmIngestor: \n  tracesOtlpEndpoint:\n    endpoint: http://groundcover-vector:4328/v1/logs\n    insecureSkipVerify: true\n    writeTimeout: 10s\n    batchSize: 100\n    flushInterval: 30s\n  logsOtlpEndpoint:\n    endpoint: http://groundcover-vector:4318/v1/logs\n    insecureSkipVerify: true\n    writeTimeout: 10s\n    batchSize: 100\n    flushInterval: 30s\n  dataDog:\n    proxyEnabled: false\n    enabled: true\n    endpoint: http://groundcover-opentelemetry-collector:8126\n    tracesPort: 8126\n    samplingRatio: 0.05\n    handleTraces: true\n    handleStats: false\n  otel:\n    proxyEnabled: false\n    direct:\n      enabled: true\n      resourceProcessor:\n        attributes:\n        - action: upsert\n          from_context: x-groundcover-env-name\n          key: env_name\n        - action: upsert\n          from_context: x-groundcover-service-name\n          key: service.name\n        - action: upsert\n          from_context: x-groundcover-env-type\n          key: gc_env_type\n      samplingRatio: 0.05\n      zipkin:\n        enabled: true\n        port: 9411\n      otlp:\n        enabled: true\n        grpcPort: 4317\n        httpPort: 4318\n        maxRecvMsgSizeMiB: 50\n      jaeger:\n        enabled: true\n        grpcPort: 14250\n        thriftHttpPort: 14268\n        thriftBinaryPort: 6832\n        thriftCompactPort: 6831\n      httpjson:\n        enabled: true\n        port: 8016\n      firehose:\n        enabled: false\n        port: 4433\n      loki:\n        enabled: true\n        port: 3100\n      rum:\n        enabled: false\n        port: 8026\n\npprof:\n  enabled: true\n  cpuSamplingDuration: 60s\n  httpUploader:\n    enabled: false\n    pushURL: https://metrics.groundcover.com/upload/pprof\n  pyroscopeUploader:\n    enabled: true\n    pushURL: https://metrics.groundcover.com\n  backoffTicker:\n    interval: 10s\n    exponent: 40\n  memoryTicker:\n    enabled: true\n    interval: 60s\n    jumpSizeInBytes: 1e+08\n    windowSize: 12h\n    initialWait: 10m\n  cpuTicker:\n    enabled: true\n    interval: 60s\n    jumpSizeInMCPU: 100\n    windowSize: 12h\n    initialWait: 10m\n\nclusterId: ksk-use2-staging-eks\nregion: \nenv: \nenvType: k8s\n\nfleetClientConfig:\n  enabled: true\n  url: http://groundcover-fleet-manager:8080/api/client/config\n  requestIntervalEnabled: true\n  maximumInitialJitter: 30s\n  requestInterval: 30s\n  initialUpdateTimeout: 60s\n\nlogs:\n  \n  scraper:\n    positionsFile: /var/run/positions/positions.yaml\n    positionsSyncInterval: 10s\n    targetSyncInterval: 5s\n    dockerMaxLogSize: 102400\n    journalConfig: \n      checkInterval: 5s\n      historyDuration: 10m\n      includeRemoteJournals: true\n      journalFilter: system.journal\n      serviceNames:\n      - kubelet\n      - kernel\n    logFileTargets: \n      []\n  \n  client:\n    batchwait: 5000ms\n    batchsize: 10485760\n    backoffConfig:\n      minBackoff: 500ms\n      maxBackoff: 5m\n      maxRetries: 10\n    externalLabels:\n      labelSet:\n        cluster_id: ksk-use2-staging-eks\n        env_name: \n        gc_env_type: k8s\n        job: sensor\n    timeout: 10s\n    useRingBuffer: false\n    dropRunningNamespaceLogs: true\n    logBatchSendQueueWorkerCount: 3 \n    logBatchSendQueueMaxSize : 10\n    otlpExportLimits:\n      jsonFlattenMaxDepth: 6\n      jsonFlattenMaxAttributes: 300\n      maxLogContentSize: 5120\n    logPatternsConfig:\n      enabled: true\n      logClusterDepth: 6\n      similarityThreshold: 0.6\n      maxChildren: 20\n      maxClusters: 2000\n      paramString: <*>\n      maxEvictionRatio: 0.8\n      maxTokens: 50\n      maxContentLength : 1024\n      containerIdCacheMaxSize : 500\n      containerIdCacheTTL : 15m\n      summarizerConfig: \n        flushInterval: 30s\n        patternsTopCount: 20\n        workloadCacheSize: 1000\n    ottlRules: \n      []\n  pipeline:\n    logDropFilters: \n      []\n    multiLineConfigs: \n      []\n    grokParserConfig: \n      - containers:\n        - kong\n        - nginx\n        pattern: '(?<timestamp>%{YEAR}[./]%{MONTHNUM}[./]%{MONTHDAY} %{TIME}) \\[%{LOGLEVEL:level}\\]\n          %{POSINT:pid}(?:#%{NUMBER:tid})?: (?:\\*%{NUMBER:connectionid} )?(?<message>[^,]+)(?:,\n          excess: %{NUMBER:excess})?(?:, by zone \"%{DATA:zone}\")?(?:, client: %{IP:client})?(?:,\n          server: (%{HOSTNAME:server}|))?(?:, request: \"%{DATA:request}\")?(?:, host: \"%{DATA:host}\")?(?:,\n          refer(?:rer)?: \"%{DATA:referer}\")?'\n        ruleName: nginx_error\n      - containers:\n        - postgresql\n        pattern: '%{TIMESTAMP_ISO8601:timestamp} %{WORD:timezone} \\[%{DATA:user_id}\\] +%{GREEDYDATA:message}'\n        ruleName: postgresql\n    decolorize: false\n    maxLogSize: 102400\n    oldLogDropThreshold: 3h \n    oldLogDropAlwaysThreshold: 12h\n    oldLogDelayStart: 2m \notelTracesAsLogs: true\notelPreprocess: true\ntracesOtlpEndpoint:\n  endpoint: http://groundcover-vector:4328/v1/logs\n  insecureSkipVerify: true\n  writeTimeout: 10s\nlogsOtlpEndpoint:\n  endpoint: http://groundcover-vector:4318/v1/logs\n  insecureSkipVerify: true\n  writeTimeout: 10s\ncustomOtlpEndpoint:\n  endpoint: http://groundcover-vector:4338/v1/logs\n  insecureSkipVerify: true\n  writeTimeout: 10s\n  batchSize: 350\n  flushInterval: 1s\n\n\nmySqlConfig:\n  KeepSQLAlias: true\n  ReplaceDigits: true\n  CollectCommands: true\n\npostgreSqlConfig:\n  DBMS: \"postgresql\"\n  KeepSQLAlias: true\n  ReplaceDigits: true\n  CollectCommands: true\n\n\ntelemetry:\n  enabled: true\n  metrics:\n    globalHosting:\n      enabled: true\n      url: http://groundcover-victoria-metrics-agent:8429/api/v1/import/prometheus\n      interval: 30s\n    customerHosting:\n      enabled: true\n      url: http://groundcover-metrics-ingester:8429/api/v1/import/prometheus\n      interval: 5m\n\n\nk8sEntitiesWatch:\n      crd:\n        allowedKinds:\n          workflow:\n            group: argoproj.io\n            kindPlural: workflows\n        enabled: true\n\n\n\n\nsensitiveHeadersObfuscationConfig: \n  enabled: true\n  caseSensitive: false\n  mode: ObfuscateSpecificValues\n  specificKeys: [\"Authorization\",\"Proxy-Authorization\",\"X-Amz-Security-Token\",\"X-Amz-Credential\",\"X-Amz-Firehose-Access-Key\",\"Cookie\",\"Set-Cookie\",\"Api-Key\",\"X-Api-Key\",\"X-Csrf-Token\",\"X-XSRF-TOKEN\",\"X-Google-Api-Key\",\"X-Firebase-Auth\"]"
kind: ConfigMap
metadata:
  labels:
    app.kubernetes.io/part-of: groundcover
  annotations:
    groundcover_version: 1.11.61
  name: sensor-configuration
  namespace: groundcover
