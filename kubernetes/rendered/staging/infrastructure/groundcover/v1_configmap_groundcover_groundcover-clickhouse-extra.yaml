# Source: groundcover-wrapper/charts/groundcover/charts/clickhouse/templates/configmap-extra.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: groundcover-clickhouse-extra
  namespace: groundcover
  labels:
    app.kubernetes.io/instance: groundcover
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: clickhouse
    app.kubernetes.io/version: 24.10.1
    helm.sh/chart: clickhouse-6.3.1
    app.kubernetes.io/component: clickhouse
data:
  01_extra_overrides.xml: "<clickhouse>\n  <opentelemetry_span_log remove=\"1\"/>\n  <logger>\n      <formatting><type>json</type></formatting>\n  </logger>\n  <max_connections>10000</max_connections>\n  <max_table_size_to_drop>0</max_table_size_to_drop>\n  <max_partition_size_to_drop>0</max_partition_size_to_drop>\n  <merge_tree>\n    <materialize_ttl_recalculate_only>0</materialize_ttl_recalculate_only>\n    <max_suspicious_broken_parts_bytes>5368709120</max_suspicious_broken_parts_bytes>\n    <max_suspicious_broken_parts>1000</max_suspicious_broken_parts>\n  </merge_tree>\n  <profiles>\n    <default>\n      <materialize_ttl_after_modify>0</materialize_ttl_after_modify>\n      <idle_connection_timeout>600</idle_connection_timeout>\n      <distributed_connections_pool_size>10000</distributed_connections_pool_size>\n      <max_distributed_connections>10000</max_distributed_connections>                \n      <allow_simdjson>true</allow_simdjson>\n      <allow_experimental_analyzer>0</allow_experimental_analyzer>\n      <date_time_input_format>best_effort</date_time_input_format>\n      <async_insert>true</async_insert>\n      <max_execution_time>60</max_execution_time>\n      <wait_for_async_insert>true</wait_for_async_insert>\n      <enable_json_type>1</enable_json_type>\n    </default>\n  </profiles>\n  <query_log>\n    <ttl>event_date + INTERVAL 10 DAY</ttl>\n  </query_log>\n  <trace_log>\n    <ttl>event_date + INTERVAL 3 DAY</ttl>\n  </trace_log>\n  <metric_log>\n    <ttl>event_date + INTERVAL 3 DAY</ttl>\n  </metric_log>\n  <processors_profile_log>\n    <ttl>event_date + INTERVAL 1 DAY</ttl>\n  </processors_profile_log>\n  <part_log>\n    <ttl>event_date + INTERVAL 1 DAY</ttl>\n  </part_log>\n  <query_views_log>\n    <ttl>event_date + INTERVAL 1 DAY</ttl>\n  </query_views_log>\n  <text_log>\n    <ttl>event_date + INTERVAL 2 DAY</ttl>\n  </text_log>\n</clickhouse>\n"
