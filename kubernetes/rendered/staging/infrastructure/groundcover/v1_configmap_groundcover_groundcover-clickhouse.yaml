# Source: groundcover-wrapper/charts/groundcover/charts/clickhouse/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: groundcover-clickhouse
  namespace: groundcover
  labels:
    app.kubernetes.io/instance: groundcover
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: clickhouse
    app.kubernetes.io/version: 24.10.1
    helm.sh/chart: clickhouse-6.3.1
    app.kubernetes.io/component: clickhouse
data:
  00_default_overrides.xml: "<clickhouse>\n  <!-- Macros -->\n  <macros>\n    <shard from_env=\"CLICKHOUSE_SHARD_ID\"></shard>\n    <replica from_env=\"CLICKHOUSE_REPLICA_ID\"></replica>\n    <layer>groundcover-clickhouse</layer>\n  </macros>\n  <!-- Log Level -->\n  <logger>\n    <level>information</level>\n  </logger>\n  <!-- Cluster configuration - Any update of the shards and replicas requires helm upgrade -->\n  <remote_servers>\n    <default>\n      <shard>\n          <replica>\n              <host>groundcover-clickhouse-shard0-0.groundcover-clickhouse-headless.groundcover.svc.cluster.local</host>\n              <port>9000</port>\n              <user from_env=\"CLICKHOUSE_ADMIN_USER\"></user>\n              <password from_env=\"CLICKHOUSE_ADMIN_PASSWORD\"></password>\n          </replica>\n      </shard>\n    </default>\n  </remote_servers>\n  <!-- keeper configuration -->\n  <keeper_server>\n    \n    <tcp_port>2181</tcp_port>\n    <server_id from_env=\"KEEPER_SERVER_ID\"></server_id>\n    <log_storage_path>/bitnami/clickhouse/keeper/coordination/log</log_storage_path>\n    <snapshot_storage_path>/bitnami/clickhouse/keeper/coordination/snapshots</snapshot_storage_path>\n\n    <coordination_settings>\n        <operation_timeout_ms>10000</operation_timeout_ms>\n        <session_timeout_ms>30000</session_timeout_ms>\n        <raft_logs_level>trace</raft_logs_level>\n    </coordination_settings>\n\n    <raft_configuration>\n    <server>\n      <id>0</id>\n      <hostname from_env=\"KEEPER_NODE_0\"></hostname>\n      <port>9444</port>\n    </server>\n    </raft_configuration>\n  </keeper_server>\n  <!-- Zookeeper configuration -->\n  <zookeeper>\n    <node>\n      <host from_env=\"KEEPER_NODE_0\"></host>\n      <port>2181</port>\n    </node>\n  </zookeeper>\n   <!-- Prometheus metrics -->\n   <prometheus>\n      <endpoint>/metrics</endpoint>\n      <port from_env=\"CLICKHOUSE_METRICS_PORT\"></port>\n      <metrics>true</metrics>\n      <events>true</events>\n      <asynchronous_metrics>true</asynchronous_metrics>\n  </prometheus>\n</clickhouse>\n"
